
# ファイヤーウォール
## セキュリティグループ
ENIに適用する仮想的なファイヤーウォール機能。
VPCやサブネットではなく、ENIという細かい単位で通信を制御する事が可能であるという特徴を持つ。

詳細な特徴は以下
- 許可を定義する
- デフォルトで全て拒否（明示的に許可されない通信は拒否される）
- プロトコル・ポート番号・送信先/送信元を定義する
- ステートフル（アウトバウンドを許可するとインバウンドも許可する）
- CIDRやセキュリティグループ同士で許可を定義できる

## ネットワークACL
サブネットに適用するファイアウォール機能。
サブネットに1つだけ設定し、サブネットに対して統一的なルールを設定する事ができる

詳細な特徴は以下
- 許可と拒否を定義可能
- デフォルトで全て許可する
- 若い番号から評価され、評価された時点で許可or拒否
- プロトコル・ポート番号・送信先/送信元・許可/拒否を定義する
- ステートレス（アウトバウンドとインバウンドそれぞれで許可する）
- CIDRでの指定


## セキュリティグループとネットワークACLの比較

| |セキュリティグループ|ネットワークACL|
|:----|:----|:----|
|設定対象|ENI|サブネット|
|適用数|複数|1つ|
|定義可能な効果|許可のみ|許可・拒否|
|デフォルト|全て拒否|全て許可|
|戻りの通信|許可（ステートフル）|拒否（ステートレス）|
|ルールの評価方法|定義された全てのルールを評価|ルールの若い順に評価|
|送信元/送信先|セキュリティグループとCIDR表記|CIDR表記|



## セキュリティグループとネットワークACLの使い分け
評価順序として、最初にネットワークACLで評価され、許可された通信がセキュリティグループで評価される。

ネットワークACLは基本的に設定せず通信を許可しておき、特定の通信だけを拒否するように利用する。
セキュリティグループを利用して、通信の許可を行うことで、特定の通信だけを許可する事ができる。
ネットワークACLで拒否する事で、セキュリティグループによる想定外の許可を防ぐような使い方。

