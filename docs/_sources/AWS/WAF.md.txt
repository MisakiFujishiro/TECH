# WAF
## note
[Hands-on for Beginners](https://pages.awscloud.com/JAPAN-event-OE-Hands-on-for-Beginners-CF_WAF-2022-confirmation_129.html)

```
AWSが提供しているWeb Application Firewall。
AWSのサービスに通信が届く前にAWS WAFがルールに従ってフィルタリングをする機能を提供する。

CloudFront・APIGW・ALB・AppSync・Cognitoユーザープールなどに対するリクエストに対応することができる。 

それぞれのサービスに対してWebACLと呼ばれるルールセットを作成し、アタッチすることでAppに影響なく開始することができる。
```

![waf_image](../img/AWS/waf/waf_image.png)
[Hands-on for Beginners](https://pages.awscloud.com/JAPAN-event-OE-Hands-on-for-Beginners-CF_WAF-2022-confirmation_129.html)より引用



## ACL(Access Control List)
WAFで定義するアクセス制御に関するルールは、`ACL（Access Control List）`と呼ばれるルールセットを作成して、ACLを対象サービスにアタッチする。

Web ACLは一つ以上のルールの集合体であり、保護するAWSリソースに関連付けられる。
複数のルールが存在する場合、それらは設定された優先順位に従って評価され、どのルールにも該当しない場合は、デフォルトのアクションが適用される。

### キャパシティユニット
ACLにどれだけのルールを設定することができるかは`キャパシティユニット`によって決まる。
ルールごとに消費するキャパシティユニットの値が決まっており、ACLで設定したルールの合計値がACLのキャパシティユニットを超えるとルール追加ができなくなってしまう。




## ルール
ACLで利用されるルールでは、不正アクセスを防ぐための定義を記載する。

ルールには、AWSが提供しアップデートする`マネージドルール`とユーザーが自身で定義する`カスタマイズルール`がある。

|ルール名|設定内容|
|:----|:----|
|マネージドルール|マネージドルールはよくある攻撃パターンに対する対策として、AWSが提供しているプリセットルール。<br>マネージドルールはカテゴリに基づいていくつかのグループに分類されている|
|AWS WAFカスタムルール|カスタムルールでは、ユーザーが特定の保護要件に合わせて独自のルールを作成できます。<br>これにより、豊富なプロパティを使用して、特定の攻撃やパターンに対応する高度なルールを設計できます。|

### マネージドルールとルールグループ
マネージドルールはよくある攻撃パターンに対する対策として、AWSが提供しているプリセットルール。

マネージドルールはカテゴリに基づいていくつかのグループに分類されている

|ルールグループ名|設定内容|
|:----|:----|
|ベースラインルールグループ|ベースラインルールグループは、一般的なWebアプリケーションの脅威に対応するための基本的なセキュリティルールを提供します。|
|IP評価ルールグループ|IP評価ルールグループは、botや不正アクセスと識別されたIPアドレスからのトラフィックを識別し、適切に対応するためのルールを含みます。|
|AWS WAFボットコントロールルールグループ|AWS WAFボットコントロールルールグループは、自動化されたトラフィックと思われるリクエスト（ボットからのもの）を特定し、これをブロックまたは許可するためのルールを提供します。|


### カスタムルール
カスタムルールでは、以下の2つを組み合わせて記述することで柔軟なルールを作成することが可能

|カテゴリ|定義内容|
|:----|:----|
|Statement|検査対象となる条件を設定し、複数のルールを「AND」または「OR」で結合する<br>HTTPヘッダーの情報などを条件にすることができる|
|Rate-based rule|通信の頻度に基づいてルールを定義することができる|
|Action|Statementの条件に基づいて、アクセスの許可または拒否を設定する|



　