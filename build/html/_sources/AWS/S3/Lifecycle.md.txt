# バージョニング
バージョニングとは、S3におけるオブジェクトについて複数のバージョンを管理することができるようになる機能。
本機能により、操作ミスによる削除などが行われても復元を行うことが可能になる。


## 現行バージョンと以前のバージョン
S3バケットにおいてバージョニングを有効化することで、バージョンIDが発行され、「現行バージョン」と「以前のバージョン」という概念が生まれる。

### バージョンの発番
バージョンIDが発行されるのは、以下のいずれかの操作が行われたときである
- 同じ名前のオブジェクトがPutされた
- オブジェクトが削除された（Lifecycleを含む）

![](../../img/AWS/s3/s3_version.png)
[絵で見て 3分でおさらいする Amazon S3 のバージョニングとライフサイクル](https://dev.classmethod.jp/articles/3minutes-s3-versioning-lifecycle/)

### バージョンの復元
以前のバージョンに戻すためには以下のいずれかの操作を行う
- 以前のバージョンをDLしてから再アップロードする
- 復元したいバージョンまでバージョンを削除する

![](../../img/AWS/s3/s3_version_2.png)
[絵で見て 3分でおさらいする Amazon S3 のバージョニングとライフサイクル](https://dev.classmethod.jp/articles/3minutes-s3-versioning-lifecycle/)


## 削除マーカー
バージョニングが有効化されているS3において、オブジェクトを削除した場合は論理的な削除として扱われ、実際は「削除マーカー」が現行バージョンとして管理されることになる。
オブジェクトのバージョン管理が行われ、表面化する現行バージョンにマーカーが設定されていることになる。

仮に、削除マーカーが削除されると、ひとつ前の世代が繰り上がることになりオブジェクトが復活する。

![](../../img/AWS/s3/s3_delete_marker.png)
[絵で見て 3分でおさらいする Amazon S3 のバージョニングとライフサイクル](https://dev.classmethod.jp/articles/3minutes-s3-versioning-lifecycle/)


# ライフサイクル
S3で管理されているオブジェクトに対して、時間契機で移行や失効のアクションを起こすことができる機能。

## 失効アクション
基本的には「削除」の操作になる。オプションによりいくつかのパターンの処理を自動で行うことができる。

### 現行バージョンの削除
現行のオブジェクトに対して、現行バージョンを削除マーカーにする

### 以前のバージョンを完全に削除する
以前のバージョンになったオブジェクトに対して、完全な削除を行う

### 期限切れの削除マーカーの削除
現行のオブジェクトが削除マーカーであり、以前のバージョンも完全に存在しないオブジェクトの削除を行う

### 不完全なマルチパートアップロードの削除
マルチパートアップロードに失敗すると一部のファイルが不完全なファイルとして残ってしまうので、これを削除する設定を行うことができる。

