<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workflows &mdash; project  ドキュメント</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="Cloud Scheduler" href="CloudScheduler.html" />
    <link rel="prev" title="サーバーレスアーキテクチャ" href="Serverless.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">AWS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../AWS/AWS.html">AWSについて</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IAM.html">IAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Network.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Front.html">Front</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EC2.html">EC2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Container.html">コンテナ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../S3.html">S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CloudFormation.html">CloudFormation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CloudWatch.html">CloudWatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DB.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SystemsManager.html">SystemsManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AWS/CloudTrail.html">CloudTrail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AWS/EventBridge.html">EventBridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AWS/AutoScaling.html">AutoScaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AWS/SES.html">SES</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GCP:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="GCP.html">GCPについて</a></li>
<li class="toctree-l1"><a class="reference internal" href="IAM.html">IAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">Google Cloud APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="GKE.html">GKE</a></li>
<li class="toctree-l1"><a class="reference internal" href="Network.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="Storage.html">ストレージ</a></li>
<li class="toctree-l1"><a class="reference internal" href="CloudLogging.html">Cloud Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="DB.html">データベースサービス</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataAnalytics.html">データ分析サービス</a></li>
<li class="toctree-l1"><a class="reference internal" href="AI.html">AIサービス</a></li>
<li class="toctree-l1"><a class="reference internal" href="GCE.html">GCE(Google Compute Engine)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Container.html">コンテナサービス</a></li>
<li class="toctree-l1"><a class="reference internal" href="Serverless.html">サーバーレスアーキテクチャ</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">ワークフローの定義</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">サービス呼び出し</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">コールバック</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">ワークフローの呼び出し</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CloudScheduler.html">Cloud Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pub-Sub.html">Pub/Sub</a></li>
<li class="toctree-l1"><a class="reference internal" href="Redis.html">Redis</a></li>
<li class="toctree-l1"><a class="reference internal" href="ArtifactRegistry.html">ArtifactRegistry</a></li>
<li class="toctree-l1"><a class="reference internal" href="Apigee.html">Apigee</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">その他</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITBasic:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/%E9%96%8B%E7%99%BA%E5%B7%A5%E7%A8%8B.html">V字モデル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/Network.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/SWA.html">SoftWareArchitecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/server.html">サーバー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/kernel.html">カーネル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/Container.html">コンテナ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/Kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/ServiceMesh.html">ServiceMesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/NFS.html">NFS(Network File System)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/SaaS.html">SaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/CICD.html">CICD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ITBasic/%E9%9D%9E%E6%A9%9F%E8%83%BD.html">非機能</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Git:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Git/basic.html">gitの基本知識</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Git/branch_strategy.html">ブランチ戦略</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Git/starter.html">gitへの登録</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Security/cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Security/SSL.html">セキュアな通信</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ProgramingCode:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ProgramingCode/Excel.html">エクセル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgramingCode/shell.html">Shell</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Book:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Book/TryHackMe.html">7日間でハッキングを始める本まとめ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Book/%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%96%8B%E7%99%BA%E3%81%AE%E5%A4%B1%E6%95%9742.html">ソフトウェア開発現場の「失敗」集めてみた</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ドキュメント管理:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Sphinx/sphinx.html">Sphinxとは</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sphinx/sphinx.html#note">note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sphinx/sphinx.html#id1">Sphinxの初期設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sphinx/sphinx.html#id9">Sphinxの基本的な利用方法</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Reveal/reveal.html">Reveal.jsとは</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reveal/reveal.html#note">note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reveal/reveal.html#id1">Reveal.jsの初期設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reveal/reveal.html#id6">Reveal.jsの基本的な利用方法</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Workflows</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/GCP/Workflows.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="workflows">
<h1>Workflows<a class="headerlink" href="#workflows" title="この見出しへのパーマリンク">¶</a></h1>
<p>Workflowsは、ワークフローを定義することで、サービスの実行を制御しながら実行するフルマネージドのオーケストレーションサービス。</p>
<p>Workflowsにより、GCPサービスの呼び出し、外部のAPIのHTTPエンドポイントへのリクエスト、BigQueryへSQLを発行などを定義した通りの順番で実行することができる。</p>
<p>実行契機には、Cloud Shedulerでのスケジュール実行、EventarcやPub/Subによるイベント契機実行、直接実行などがサポートされている。</p>
<p>ワークフローの定義は、YAMLやJSONがサポートされており、順次実行だけでなく、条件分岐・並列実行・繰り返すなどが定義可能。</p>
<p><img alt="" src="../_images/workflows_image.png" />
<a class="reference external" href="https://cloud.google.com/workflows/docs/overview?hl=ja">ワークフローの概要</a></p>
<section id="id1">
<h2>ワークフローの定義<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<p>以下のような構文を利用してワークフローを定義する。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>種類</p></th>
<th class="head text-left"><p>名称</p></th>
<th class="head text-left"><p>説明</p></th>
<th class="head text-left"><p>使用例/用途</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>✅ 基本</p></td>
<td class="text-left"><p>steps</p></td>
<td class="text-left"><p>処理の実行ステップを定義する基本構文</p></td>
<td class="text-left"><p>- stepName: ...</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>✅ 基本</p></td>
<td class="text-left"><p>assign</p></td>
<td class="text-left"><p>変数の定義・代入を行う</p></td>
<td class="text-left"><p>assign: [ x: 10 ]</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>✅ 基本</p></td>
<td class="text-left"><p>call</p></td>
<td class="text-left"><p>HTTP/Google API呼び出し or サブワークフロー実行</p></td>
<td class="text-left"><p>call: http.get or call: mySubflow</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>✅ 基本</p></td>
<td class="text-left"><p>return</p></td>
<td class="text-left"><p>ワークフローの出力値を返す</p></td>
<td class="text-left"><p>return: ${result}</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>✅ 基本</p></td>
<td class="text-left"><p>raise</p></td>
<td class="text-left"><p>エラーを発生させてワークフローを停止</p></td>
<td class="text-left"><p>raise: &quot;Error occurred&quot;</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>✅ フロー制御</p></td>
<td class="text-left"><p>switch</p></td>
<td class="text-left"><p>条件により処理を分岐する</p></td>
<td class="text-left"><p>if/elseに相当</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>✅ フロー制御</p></td>
<td class="text-left"><p>for</p></td>
<td class="text-left"><p>配列などの繰り返し処理</p></td>
<td class="text-left"><p>for: value in array</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>✅ フロー制御</p></td>
<td class="text-left"><p>parallel</p></td>
<td class="text-left"><p>ステップを並列に実行</p></td>
<td class="text-left"><p>マルチAPI呼び出しなど</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>✅ フロー制御</p></td>
<td class="text-left"><p>subworkflow</p></td>
<td class="text-left"><p>再利用可能な処理を定義（関数のようなもの）</p></td>
<td class="text-left"><p>call: myFunc</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>✅ フロー制御</p></td>
<td class="text-left"><p>try / except</p></td>
<td class="text-left"><p>エラーハンドリング（例外処理）</p></td>
<td class="text-left"><p>try: ... except: ...</p></td>
</tr>
</tbody>
</table>
<p>詳細は、<a class="reference external" href="https://cloud.google.com/workflows/docs/reference/syntax">Syntax overview</a>参照。</p>
<p>ワークフローの一例。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">main</span><span class="p">:</span>
<span class="w">  </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">init</span><span class="p">:</span>
<span class="w">        </span><span class="nt">assign</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;my-bucket-name&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">notifyUrl</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://YOUR_REGION-YOUR_PROJECT.cloudfunctions.net/notifyFunction&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">listFiles</span><span class="p">:</span>
<span class="w">        </span><span class="nt">call</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">googleapis.storage.v1.objects.list</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${bucket}</span>
<span class="w">        </span><span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">objectList</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">checkFiles</span><span class="p">:</span>
<span class="w">        </span><span class="nt">switch</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${len(objectList.items) == 0}</span>
<span class="w">            </span><span class="nt">next</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">noFiles</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${len(objectList.items) &gt; 0}</span>
<span class="w">            </span><span class="nt">next</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sendNotification</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">noFiles</span><span class="p">:</span>
<span class="w">        </span><span class="nt">call</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sys.log</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;No</span><span class="nv"> </span><span class="s">files</span><span class="nv"> </span><span class="s">found</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">bucket.&quot;</span>
<span class="w">        </span><span class="nt">next</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">end</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sendNotification</span><span class="p">:</span>
<span class="w">        </span><span class="nt">call</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http.post</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${notifyUrl}</span>
<span class="w">          </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">            </span><span class="nt">Content-Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span>
<span class="w">          </span><span class="nt">body</span><span class="p">:</span>
<span class="w">            </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${&quot;Found &quot; + string(len(objectList.items)) + &quot; file(s) in &quot; + bucket}</span>
<span class="w">        </span><span class="nt">result</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">notifyResult</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">end</span><span class="p">:</span>
<span class="w">        </span><span class="nt">return</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${&quot;Workflow completed&quot;}</span>
</pre></div>
</div>
<p>上記では、6つのステップが定義されており、それぞれの以下のような処理が実行される。
なお、workflowsではnextを設定すると次の実行ステップを指定することができ、指定しない場合は次に記載されているステップが実行される。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>ステップ名</p></th>
<th class="head text-left"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>init</p></td>
<td class="text-left"><p>使う変数（バケット名、通知先URL）を定義</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>listFiles</p></td>
<td class="text-left"><p>Cloud Storage の指定バケットにあるファイル一覧を取得</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>checkFiles</p></td>
<td class="text-left"><p>ファイルがあるかないかでフローを分岐（switch を使った if 分岐）</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>noFiles</p></td>
<td class="text-left"><p>ファイルがない場合、ログを出して終了へ</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>sendNotification</p></td>
<td class="text-left"><p>ファイルがある場合、Cloud Functionに通知をPOST送信</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>end</p></td>
<td class="text-left"><p>ワークフローを終了し、結果文字列を返す</p></td>
</tr>
</tbody>
</table>
<section id="id2">
<h3>サービス呼び出し<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h3>
<p>Workflowsでは以下の呼び出しを行い、処理を定義することができる。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>呼び出し元</p></th>
<th class="head text-left"><p>概要</p></th>
<th class="head text-left"><p>代表的な用途</p></th>
<th class="head text-left"><p>記述方法</p></th>
<th class="head text-left"><p>備考</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>① HTTP API</p></td>
<td class="text-left"><p>任意の HTTP エンドポイントへ GET / POST 等のリクエストを送る</p></td>
<td class="text-left"><p>Cloud Run / Cloud Functions 呼び出し、外部API</p></td>
<td class="text-left"><p>call: http.get / http.post</p></td>
<td class="text-left"><p>認証が必要なら Bearer トークン付きで送信可</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>② コネクタ</p></td>
<td class="text-left"><p>Google Cloud サービス用のネイティブラッパー。REST API を抽象化した簡易インターフェース</p></td>
<td class="text-left"><p>Cloud Storage, BigQuery, Pub/Sub など</p></td>
<td class="text-left"><p>call: googleapis.bigquery.v2.jobs.insert</p></td>
<td class="text-left"><p>サービスアカウントに対応権限が必要</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>③ 標準ライブラリ</p></td>
<td class="text-left"><p>Workflows に組み込まれた関数群。文字列処理、リスト操作、Base64 変換など</p></td>
<td class="text-left"><p>sleep, string(), len(), base64.encode() など</p></td>
<td class="text-left"><p>call: sys.sleep, ${string(123)}</p></td>
<td class="text-left"><p>明示的な import 不要。Pythonの標準関数に近い感覚</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>④ 環境変数</p></td>
<td class="text-left"><p>Workflows 実行環境が持つ組み込み情報（プロジェクトID、実行IDなど）</p></td>
<td class="text-left"><p>ロギング、トレース、デバッグ</p></td>
<td class="text-left"><p>${sys.environment.workflow_project} など</p></td>
<td class="text-left"><p>sys.environment 名前空間に多数存在</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id3">
<h3>コールバック<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h3>
<p>ワークフロー内で動機的な処理（処理の完了を待ってから次のステップへ進む処理）を実装したい場合、コールバックエンドポイントを利用することができる。
実行したサービスによる処理が完了したら、ワークフローのコールバックエンドポイントへリクエストを投げるように処理を記述することで、一時停止していたワークフローを再開でき、タイムアウトの設定も可能。</p>
</section>
</section>
<section id="id4">
<h2>ワークフローの呼び出し<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h2>
<p>workflowsは、GUIやCLIを利用した手動での実行もサポートされているが、他のサービスからの呼び出しもサポートされている。</p>
<p>呼び出し時の注意点として、Cloud Scheduler はユーザー指定のサービスアカウントによる明示的な認可が可能である一方、Eventarc は内部生成された SA によって自動的に Workflows を起動し、対応する IAM 設定が求められる。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>実行方法</p></th>
<th class="head text-left"><p>トリガー元</p></th>
<th class="head text-left"><p>主な用途</p></th>
<th class="head text-left"><p>引数の渡し方</p></th>
<th class="head text-left"><p>実行者</p></th>
<th class="head text-left"><p>認証方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Cloud Scheduler</p></td>
<td class="text-left"><p>定期スケジュール</p></td>
<td class="text-left"><p>毎時/毎日などの定期バッチ処理</p></td>
<td class="text-left"><p>JSON形式でHTTP Bodyに渡す</p></td>
<td class="text-left"><p>Cloud Scheduler（Cloud Schedulerが引き受けるSA）</p></td>
<td class="text-left"><p>Cloud Schedulerに指定するユーザーが作成するSAを対象に認可</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Eventarc</p></td>
<td class="text-left"><p>GCS, Pub/Sub, Audit Logs などのイベント</p></td>
<td class="text-left"><p>イベントドリブンで反応するワークフロー</p></td>
<td class="text-left"><p>CloudEvents形式（JSON）で渡される</p></td>
<td class="text-left"><p>自動的に生成されたサービスアカウント</p></td>
<td class="text-left"><p>Event arcが利用する自動的に生成されたSAを対象に認可</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Serverless.html" class="btn btn-neutral float-left" title="サーバーレスアーキテクチャ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CloudScheduler.html" class="btn btn-neutral float-right" title="Cloud Scheduler" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, author.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>