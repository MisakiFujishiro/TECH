# ストレージ
## Cloud Storage
あらゆるファイルをスケーラブルかつ安全に保存できるオブジェクトサービス。
画像動画音声、ログファイルなど、非構造データに関しても保存が可能。

### バケット
Cloud Storageでは、バケット呼ばれる単位で「オブジェクト」を保存する。
```
プロジェクト
└─ バケット（例：my-photo-bucket）
   ├─ photo1.jpg（オブジェクト）
   ├─ report.csv
   └─ ...
```

バケットを作成する際に、データをどのように保存するかのオプションを指定することで冗長性を高めることができる。
Cloud Storageはリージョンベースのリソースであるが簡単にグローバル（マルチリージョン）リソースにすることができる。

|タイプ|説明|特徴|
|:----|:----|:----|
|単一リージョン|東京（asia-northeast1）など|レイテンシ重視・コスト最適|
|デュアルリージョン|明示的に2つのリージョン（例：東京＋大阪）に配置|DR（災害対策）構成が明示的に可能|
|マルチリージョン|asia, us, euなどの地域単位で指定|GCPが自動で複数リージョンにレプリケーション|

また、オブジェクトのURLについては、以下の形式をとるためロケーションに依存しない。
```
https://storage.googleapis.com/[BUCKET]/[OBJECT]
```
### アクセス制御
アクセス制御については`IAM`と`オブジェクトACL(非推奨)`の2つが可能。
現在は、IAMでの利用が推奨されている。

|方法|特徴|現在の推奨|
|:----|:----|:----|
|IAM|プロジェクト/バケット単位で制御。大規模運用に向く|✅ 推奨|
|オブジェクトACL|個別のファイルごとに細かく制御できるが、管理が煩雑に|❌ 非推奨|



### ライフサイクル
`バージョンニング機能`では、上書き・削除されたファイルの旧バージョンを保持できる。

`ライフサイクルルール`では、ファイルの自動削除やストレージのアーカイブが可能。

### ストレージクラス
CloudStorageにはストレージクラスの機能があり、アクセス頻度や保存期間に応じて、コストを抑制することができる。
特徴と用件を照らし合わせトレードオフで利用ストレージを選定する。

![](../img/GCP/Storage/Storage_class.png)
[Google Cloud Fundamentals: Core Infrastructure 日本語版](https://www.coursera.org/learn/gcp-fundamentals-jp/lecture/40yXj/google-cloud-netutowaku)

|ストレージクラス|想定用途（アクセス頻度）|最低保存期間|主な特徴|
|:----|:----|:----|:----|
|Standard|Hot data（高頻度アクセス）|なし|高可用・高性能、デフォルトクラス|
|Nearline|月1回程度のアクセス|30日|安価なストレージ、取り出しコストあり|
|Coldline|3か月に1回程度のアクセス|90日|さらに低価格、バックアップなどに最適|
|Archive|年1回程度のアクセス|365日|最安値だが高い取り出しコスト、長期保存用|
